version: '3.8'

services:
  builder:
    image: embodios-builder:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: embodios-builder
    working_dir: /workspace
    volumes:
      # Mount kernel source for compilation
      - ./kernel:/workspace/kernel
      # Mount models directory for model embedding
      - ./models:/workspace/models
      # Mount scripts for build orchestration
      - ./scripts:/workspace/scripts
    environment:
      # Preserve build environment settings
      - CROSS_PREFIX=/opt/cross
      - PATH=/opt/cross/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    command: bash -c "echo 'EMBODIOS Builder Ready' && echo '' && echo 'Available commands:' && echo '  make -C kernel           - Build kernel' && echo '  make -C kernel iso-prod  - Build production ISO' && echo '  bash kernel/scripts/make_iso.sh --models  - Build ISO with models' && echo '' && echo 'Examples:' && echo '  docker-compose run builder make -C kernel' && echo '  docker-compose run builder bash kernel/scripts/make_iso.sh --models' && bash"
    stdin_open: true
    tty: true
